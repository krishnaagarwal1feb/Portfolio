<html>
<head>
    <title>threejs - models</title>

    <style>
    	body{
    		margin: 0;
    		overflow: hidden;
    	}
    </style>
</head>
<body>

    <canvas id="myCanvas"></canvas>

    <script src="three.js"></script>
    <script src="GLTFLoader.js"></script>

    <script>

    var scene, renderer, camera, stats;
    var model, skeleton,mixer,clock;
    var	myCanvas = document.getElementById('myCanvas');

    var tauntAction;
    var tauntWeight;
    var actions, settings;  

    //RENDERER
    renderer = new THREE.WebGLRenderer({
      canvas: myCanvas, 
      antialias: true
    });
    renderer.setClearColor(0x000000);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);

    //CAMERA
    camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 1000 );

    //SCENE
    scene = new THREE.Scene();

    //LIGHTS
    var light = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(light);

    var light2 = new THREE.PointLight(0xffffff, 0.5);
    scene.add(light2);
  

    //Adding a plane to the scene

    var plane = new THREE.Mesh( new THREE.PlaneBufferGeometry( 100, 100 ), new THREE.MeshPhongMaterial( { color: 0x999999, depthWrite: false } ) );
    plane.rotation.x  = Math.PI/2;
    plane.receiveShadow = true;
    scene.add(plane);

    //Initialising GLTF Loader
    var loader = new THREE.GLTFLoader(); 

  //  loader.load('AnimatedXBotTaunt.glb', handle_load);
 
    loader.load('AnimatedXBotTaunt.glb', function ( gltf ) 
    {
        model = gltf.scene;
        scene.add( model );
        model.traverse( function ( object ) {

            if ( object.isMesh ) object.castShadow = true;

        } );

        skeleton = new THREE.SkeletonHelper( model );
        skeleton.visible = false;
        scene.add( skeleton );

     //   createPanel();

        var animations = gltf.animations;
        mixer = new THREE.AnimationMixer( model );
        tauntAction = mixer.clipAction( animations[ 0 ] );

        actions = [ tauntAction ];
        console.log("Model = " + model);
        console.log("Skelton = " + skeleton);
        console.log("Mixer = " + mixer);
        activateAllActions();
        animate();
    } );

    function activateAllActions() 
    {
        actions.forEach( function ( action ) {
            console.log("Animation = " + action); 
            action.play();

        } );
    }

    var prevTime = Date.now();
    function animate()
    {
        var time = Date.now();
        requestAnimationFrame(animate);
        mixer.update( (time - prevTime)*0.001 );
        renderer.render( scene, camera );
    }

    </script>
</body>
</html>
